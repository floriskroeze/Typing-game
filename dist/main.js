class u{constructor(t){this.time=0,this.observers=[],this.intervalId=null,this.onTimerEnd=t}setTime(t){this.time=t,this.notifyObservers(this.getTime())}start(){this.isRunning()||(this.intervalId=window.setInterval(()=>{this.time>0?(this.time--,this.notifyObservers(this.getTime())):this.stop()},1e3))}stop(){this.isRunning()&&(clearInterval(this.intervalId),this.intervalId=null),this.onTimerEnd()}getTime(){return this.time}isRunning(){return this.intervalId!==null}registerObserver(t){this.observers.push(t)}unregisterObserver(t){this.observers=this.observers.filter(i=>i!==t)}notifyObservers(t){this.observers.forEach(i=>i.update(t))}}var n=(e=>(e.START="start",e.PLAYING="game",e.FINISHED="end",e))(n||{});const h=e=>document==null?void 0:document.getElementById(e),g=e=>{[n.START,n.PLAYING,n.FINISHED].forEach(t=>h(t).classList.add("hidden")),console.log(e),h(e).classList.remove("hidden")};var r=(e=>(e.START="start",e.PLAYING="playing",e.FINISHED="finished",e))(r||{});class E{constructor(t,i,s,a,d,m,f,S){this.config=i,this.startScreen=s,this.gameScreen=a,this.endScreen=d,this.timer=m,this.inputHandler=f,this.localDataProvider=S,this.currentState=t,this.enterState(t)}startGame(){this.enterState(r.PLAYING)}endGame(){this.enterState(r.FINISHED)}enterState(t){this.exitCurrentState(),this.currentState=t,this.enterCurrentState()}exitCurrentState(){switch(this.currentState){case r.START:this.handleStartExit();break;case r.PLAYING:this.handlePlayingExit();break;case r.FINISHED:this.handleEndExit();break}}enterCurrentState(){switch(this.currentState){case r.START:break;case r.PLAYING:this.handlePlayingEnter();break;case r.FINISHED:this.handleEndEnter();break}console.log(n[this.currentState.toUpperCase()]),g(n[this.currentState.toUpperCase()])}handlePlayingEnter(){this.setupGameText(),this.inputHandler.focusInput(),this.inputHandler.activeFocusManagement(),this.setupGameTimer()}handleEndEnter(){}handleStartExit(){this.startScreen.reset()}handlePlayingExit(){this.gameScreen.reset()}handleEndExit(){this.endScreen.reset()}resetGame(){throw new Error("Method not implemented.")}setupGameText(){const t=this.localDataProvider.getText(this.config);this.gameScreen.renderText(t),this.gameScreen.updateCurrentLetter(0),this.inputHandler.setText(t)}setupGameTimer(){this.timer=new u(()=>this.endGame()),this.gameScreen.timerDisplay.setTimer(this.timer),this.timer.setTime(this.config.gameLength),this.inputHandler.setOnStart(()=>this.timer.start())}}const p=[{text:"the quick brown fox jumps over the lazy dog",difficulty:0},{text:"pack my box with five dozen liquor jugs",difficulty:0},{text:"sphinx of black quartz judge my vow",difficulty:1},{text:"how vexingly quick daft zebras jump",difficulty:1},{text:"the five boxing wizards jump quickly",difficulty:2}];class v{getText(t){const i=p.filter(a=>a.difficulty===t.difficulty);if(i.length===0)return"No texts with difficulty found";const s=Math.floor(Math.random()*i.length);return i[s].text}}class T{constructor(){this.container=document.getElementById(n.FINISHED)}reset(){}}const I=(e,t)=>`${e.toLocaleString(void 0,{minimumIntegerDigits:2,useGrouping:!1})} : ${t.toLocaleString(void 0,{minimumIntegerDigits:2,useGrouping:!1})}`,L=e=>Math.floor(e/60),y=e=>e%60;class x{constructor(){this.timer=null,this.element=document.getElementById("timer"),this.reset()}setTimer(t){this.timer=t,this.timer.registerObserver(this)}reset(){this.element.innerHTML="00:00"}update(t){this.setTimeInDisplay(t)}setTimeInDisplay(t){this.element.innerHTML=I(L(t),y(t))}}class A{constructor(){this.textContainer=document.getElementById("text-container"),this.timerDisplay=new x}renderText(t){[...t].forEach((i,s)=>this.textContainer.innerHTML+=`<span id="letter-${s}">${i}</span>`)}updateCurrentLetter(t){var i,s;(s=(i=this.textContainer.querySelector(`#letter-${t}`))==null?void 0:i.classList)==null||s.add("border-b-2","border-blue-500","whitespace-pre")}markLetter(t,i){i?this.markLetterCorrect(t):this.markLetterIncorrect(t),this.updateCurrentLetter(t+=1)}reset(){this.textContainer.innerHTML="",this.timerDisplay.reset()}markLetterCorrect(t){var i,s;(i=this.textContainer.querySelector(`#letter-${t}`))==null||i.classList.remove("border-b-2"),(s=this.textContainer.querySelector(`#letter-${t}`))==null||s.classList.add("text-green-500")}markLetterIncorrect(t){var i,s;(i=this.textContainer.querySelector(`#letter-${t}`))==null||i.classList.remove("border-b-2"),(s=this.textContainer.querySelector(`#letter-${t}`))==null||s.classList.add("text-red-500")}}var l=(e=>(e[e.EASY=0]="EASY",e[e.MEDIUM=1]="MEDIUM",e[e.HARD=2]="HARD",e))(l||{});const k={TEN_SECONDS:10,HALF_MINUTE:30,ONE_MINUTE:60,TWO_MINUTES:120};class w{constructor(t){if(this.DIFFICULTY_DEFAULT="EASY",this.GAME_LENGTH_DEFAULT="TEN_SECONDS",this.onStartRequested=t,this.container=h(n.START),this.difficultyInputs=document.querySelectorAll("input[name=difficulty-select]"),this.gameLengthInputs=document.querySelectorAll("input[name=gameLength-select]"),this.startButton=document.getElementById("start-button"),!this.container||!this.startButton)throw new Error("StartScreen: Required DOM elements not found");this.startButton.addEventListener("click",this.handleStartClick.bind(this))}reset(){Array.from(this.difficultyInputs).forEach(t=>t.checked=t.value===this.DIFFICULTY_DEFAULT),Array.from(this.gameLengthInputs).forEach(t=>t.checked=t.value===this.GAME_LENGTH_DEFAULT)}handleStartClick(t){t.preventDefault(),console.log("Start clicked"),console.log(this.getSelectedDifficulty(),this.getSelectedGameLength());const i={difficulty:l[this.getSelectedDifficulty()],gameLength:k[this.getSelectedGameLength()]};console.log(i),this.onStartRequested(i)}getSelectedDifficulty(){var t;return(t=Array.from(this.difficultyInputs).find(i=>i.checked))==null?void 0:t.value}getSelectedGameLength(){var t;return(t=Array.from(this.gameLengthInputs).find(i=>i.checked))==null?void 0:t.value}}class D{constructor(t,i){this.FOCUS_POLL_INTERVAL=1e3,this.chars=[],this.currentIndex=0,this.isSessionActive=!1,this.isStarted=!1,this.mistakeCount=0,this.lostFocusTimeout=null,this.handleWindowFocus=s=>{this.isSessionActive&&this.startPollingFocus()},this.handleWindowBlur=s=>{this.lostFocusTimeout&&clearTimeout(this.lostFocusTimeout)},this.inputElement=document.getElementById("input"),this.onStart=t,this.onProgress=i,this.inputElement.addEventListener("input",this.handleInput.bind(this)),this.inputElement.addEventListener("keydown",this.handleKeyDown.bind(this))}destroy(){this.inputElement.removeEventListener("input",this.handleInput),this.inputElement.removeEventListener("keydown",this.handleKeyDown)}setText(t){this.reset(),this.chars=[...t]}setOnStart(t){this.onStart=t}reset(){this.mistakeCount=0,this.currentIndex=0,this.isSessionActive=!1,this.chars=[]}getCurrentPosition(){return this.currentIndex}getMistakes(){return this.mistakeCount}focusInput(){this.isSessionActive=!0,this.inputElement.focus(),setTimeout(()=>this.inputElement.focus(),50),setTimeout(()=>this.inputElement.focus(),150)}activeFocusManagement(){this.isSessionActive=!0,this.focusInput(),this.startPollingFocus(),window.addEventListener("focus",this.handleWindowFocus),window.addEventListener("blur",this.handleWindowBlur)}handleInput(t){this.isStarted||(this.isStarted=!0,this.onStart&&this.onStart());const i=this.inputElement.value,s=this.chars[this.currentIndex],a=i===s;a||this.mistakeCount++,this.onProgress(this.currentIndex,a),this.inputElement.value="",this.currentIndex++}handleKeyDown(t){this.preventDefaultBehaviors(t)}startPollingFocus(){const t=()=>{this.isSessionActive&&(document.activeElement!==this.inputElement&&this.focusInput(),this.lostFocusTimeout=setTimeout(t,this.FOCUS_POLL_INTERVAL))};t()}preventDefaultBehaviors(t){t.key==="Backspace"&&t.preventDefault(),(t.key==="ArrowLeft"||t.key==="ArrowRight")&&t.preventDefault(),(t.key==="Home"||t.key==="End")&&t.preventDefault(),t.key==="Delete"&&t.preventDefault(),t.key==="Shift"&&t.preventDefault()}}const o=new A,c=new E(r.START,{difficulty:1,gameLength:10},new w(e=>{c.config=e,c.startGame()}),o,new T,new u(()=>{}),new D(()=>{},(e,t)=>o.markLetter(e,t)),new v);
