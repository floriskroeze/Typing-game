class l{constructor(){this.time=0,this.observers=[],this.intervalId=null}setTime(t){this.time=t,this.notifyObservers(this.getTimeString())}start(){this.intervalId===null&&(this.intervalId=window.setInterval(()=>{this.time>0?(this.time--,this.notifyObservers(this.getTimeString())):this.stop()},1e3))}stop(){this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null)}getTimeString(){return this.time.toString()}isRunning(){return this.intervalId!==null}registerObserver(t){this.observers.push(t)}unregisterObserver(t){this.observers=this.observers.filter(i=>i!==t)}notifyObservers(t){this.observers.forEach(i=>i.update(this.time.toString()))}}var r=(e=>(e.START="start",e.PLAYING="game",e.FINISHED="end",e))(r||{});const o=e=>document==null?void 0:document.getElementById(e),S=e=>{[r.START,r.PLAYING,r.FINISHED].forEach(t=>o(t).classList.add("hidden")),o(e).classList.remove("hidden")};var s=(e=>(e.START="start",e.PLAYING="playing",e.END="end",e))(s||{});class v{constructor(t,i,n,a,m,f,E,g){this.config=i,this.startScreen=n,this.gameScreen=a,this.endScreen=m,this.timer=f,this.inputHandler=E,this.localDataProvider=g,this.currentState=t,this.enterState(t)}enterState(t){this.exitCurrentState(),this.currentState=t,this.enterCurrentState()}exitCurrentState(){switch(this.currentState){case s.START:this.handleStartExit();break;case s.PLAYING:this.handlePlayingExit();break;case s.END:this.handleEndExit();break}}enterCurrentState(){switch(this.currentState){case s.START:break;case s.PLAYING:this.handlePlayingEnter();break;case s.END:this.handleEndEnter();break}}handlePlayingEnter(){S(r[this.currentState.toUpperCase()]);const t=this.localDataProvider.getText(this.config);this.gameScreen.renderText(t),this.inputHandler.setText(t),this.inputHandler.focusInput(),this.inputHandler.activeFocusManagement(),this.gameScreen.updateCurrentLetter(0),this.timer=new l}handleEndEnter(){throw new Error("Method not implemented.")}handleStartExit(){this.startScreen.reset()}handlePlayingExit(){this.gameScreen.reset()}handleEndExit(){throw new Error("Method not implemented.")}startGame(){this.enterState(s.PLAYING)}endGame(){this.enterState(s.END)}resetGame(){throw new Error("Method not implemented.")}}const p=[{text:"the quick brown fox jumps over the lazy dog",difficulty:0},{text:"pack my box with five dozen liquor jugs",difficulty:0},{text:"sphinx of black quartz judge my vow",difficulty:1},{text:"how vexingly quick daft zebras jump",difficulty:1},{text:"the five boxing wizards jump quickly",difficulty:2}];class I{getText(t){const i=p.filter(a=>a.difficulty===t.difficulty);if(i.length===0)return"No texts with difficulty found";const n=Math.floor(Math.random()*i.length);return i[n].text}}class L{constructor(){this.container=document.getElementById(r.FINISHED)}}class y{constructor(){this.timerElement=document.getElementById("timer"),this.textContainer=document.getElementById("text-container")}renderText(t){[...t].forEach((i,n)=>this.textContainer.innerHTML+=`<span id="letter-${n}">${i}</span>`)}updateCurrentLetter(t){var i,n;console.log(t),(n=(i=this.textContainer.querySelector(`#letter-${t}`))==null?void 0:i.classList)==null||n.add("text-blue-500","border-b-2")}markLetter(t,i){i?this.markLetterCorrect(t):this.markLetterIncorrect(t),this.updateCurrentLetter(t+=1)}markLetterCorrect(t){var i,n;(i=this.textContainer.querySelector(`#letter-${t}`))==null||i.classList.remove("border-b-2"),(n=this.textContainer.querySelector(`#letter-${t}`))==null||n.classList.add("text-green-500","animate-[bounce_0.3s_ease-in-out_1]")}markLetterIncorrect(t){var i,n;(i=this.textContainer.querySelector(`#letter-${t}`))==null||i.classList.remove("border-b-2"),(n=this.textContainer.querySelector(`#letter-${t}`))==null||n.classList.add("text-red-500","animate-[bounce_0.3s_ease-in-out_1]")}reset(){this.textContainer.innerHTML="",this.timerElement.innerHTML="00:00"}}var d=(e=>(e[e.EASY=0]="EASY",e[e.MEDIUM=1]="MEDIUM",e[e.HARD=2]="HARD",e))(d||{});const h={TEN_SECONDS:10,HALF_MINUTE:30,ONE_MINUTE:60,TWO_MINUTES:120};class T{constructor(t){if(this.DIFFICULTY_DEFAULT="EASY",this.GAME_LENGTH_DEFAULT=h.TEN_SECONDS,this.onStartRequested=t,this.container=o(r.START),this.difficultyInputs=document.querySelectorAll("input[name=difficulty-select]"),this.gameLengthInputs=document.querySelectorAll("input[name=gameLength-select]"),this.startButton=document.getElementById("start-button"),!this.container||!this.startButton)throw new Error("StartScreen: Required DOM elements not found");this.startButton.addEventListener("click",this.handleStartClick.bind(this))}reset(){Array.from(this.difficultyInputs).forEach(t=>t.checked=t.value===this.DIFFICULTY_DEFAULT),Array.from(this.gameLengthInputs).forEach(t=>t.checked=parseInt(t.value)===this.GAME_LENGTH_DEFAULT)}handleStartClick(t){t.preventDefault();const i={difficulty:d[this.getSelectedDifficulty()],gameLength:h[this.getSelectedGameLength()]};this.onStartRequested(i)}getSelectedDifficulty(){var t;return(t=Array.from(this.difficultyInputs).find(i=>i.checked))==null?void 0:t.value}getSelectedGameLength(){var t;return(t=Array.from(this.gameLengthInputs).find(i=>i.checked))==null?void 0:t.value}}class A{constructor(t,i){this.FOCUS_POLL_INTERVAL=1e3,this.chars=[],this.currentIndex=0,this.isSessionActive=!1,this.mistakeCount=0,this.lostFocusTimeout=null,this.handleWindowFocus=n=>{this.isSessionActive&&(console.log("focus"),this.startPollingFocus())},this.handleWindowBlur=n=>{console.log("blur"),this.lostFocusTimeout&&clearTimeout(this.lostFocusTimeout)},this.inputElement=document.getElementById("input"),this.onStart=t,this.onProgress=i,this.inputElement.addEventListener("input",this.handleInput.bind(this)),this.inputElement.addEventListener("keydown",this.handleKeyDown.bind(this))}destroy(){this.inputElement.removeEventListener("input",this.handleInput),this.inputElement.removeEventListener("keydown",this.handleKeyDown)}setText(t){this.reset(),this.chars=[...t]}reset(){this.mistakeCount=0,this.currentIndex=0,this.isSessionActive=!1,this.chars=[]}getCurrentPosition(){return this.currentIndex}getMistakes(){return this.mistakeCount}focusInput(){this.isSessionActive=!0,this.inputElement.focus(),setTimeout(()=>this.inputElement.focus(),50),setTimeout(()=>this.inputElement.focus(),150)}activeFocusManagement(){this.isSessionActive=!0,this.focusInput(),this.startPollingFocus(),window.addEventListener("focus",this.handleWindowFocus),window.addEventListener("blur",this.handleWindowBlur)}handleInput(t){this.onStart&&this.onStart();const i=this.inputElement.value,n=this.chars[this.currentIndex],a=i===n;a||this.mistakeCount++,this.onProgress(this.currentIndex,a),this.inputElement.value="",this.currentIndex++}handleKeyDown(t){this.preventDefaultBehaviors(t)}startPollingFocus(){const t=()=>{this.isSessionActive&&(document.activeElement!==this.inputElement&&this.focusInput(),this.lostFocusTimeout=setTimeout(t,this.FOCUS_POLL_INTERVAL),console.log("polling"))};t()}preventDefaultBehaviors(t){t.key==="Backspace"&&t.preventDefault(),(t.key==="ArrowLeft"||t.key==="ArrowRight")&&t.preventDefault(),(t.key==="Home"||t.key==="End")&&t.preventDefault(),t.key==="Delete"&&t.preventDefault(),t.key==="Shift"&&t.preventDefault()}}const c=new y,u=new v(s.START,{difficulty:1,gameLength:10},new T(e=>{u.config=e,u.startGame()}),c,new L,new l,new A(()=>{},(e,t)=>c.markLetter(e,t)),new I);
