var n=(e=>(e.START="start-screen",e.SETTINGS="settings",e.GAMEBOARD="gameboard",e.END="end-screen",e))(n||{});const a=e=>(document==null?void 0:document.getElementById(e))??null,m=e=>{var t;(t=a(e))==null||t.classList.remove("hidden")},v=e=>{var t;(t=a(e))==null||t.classList.add("hidden")};class S{constructor(t=null,r=0,s=0,i=0){this._currentLetter=t,this._mistakeCount=r,this._gameTime=s,this._totalCharactersTyped=i}get currentLetter(){return this._currentLetter}set currentLetter(t){this._currentLetter=t}get mistakeCount(){return this._mistakeCount}set mistakeCount(t){this._mistakeCount=t}get gameTime(){return this._gameTime}set gameTime(t){this._gameTime=t}get totalCharactersTyped(){return this._totalCharactersTyped}set totalCharactersTyped(t){this._totalCharactersTyped=t}static getInstance(){return this.instance||(this.instance=new this("",0,0,0)),this.instance}}class p{constructor(t){this.time=0,this.observers=[],this.time=t,this.notifyObservers()}start(){const t=setInterval(()=>{this.time--,this.notifyObservers(),this.time===0&&clearInterval(t)},1e3)}stop(){this.time=0}getTimeString(){return this.time.toString()}registerObserver(t){this.observers.push(t)}unregisterObserver(t){this.observers=this.observers.filter(r=>r!==t)}notifyObservers(){this.observers.forEach(t=>t.update(this.time.toString()))}}class T{constructor(t){this.currentIndex=-1,this.gameText=[],this.gameText=t}getCurrentIndex(){return this.currentIndex}current(){return this.gameText[this.currentIndex]}hasNext(){return this.currentIndex<this.gameText.length}hasPrev(){return this.currentIndex!==0}next(){return this.hasNext()?(this.currentIndex++,this.gameText[this.currentIndex]):null}prev(){return this.hasPrev()?(this.currentIndex--,this.gameText[this.currentIndex]):null}reset(){}}async function y(e){console.log("Selecting game text with difficulty: "+e);const t=await w(),r=b(t.gameTexts,e),s=C(r);return{words:L(s.text),gameText:s}}const w=async()=>await fetch("src/data.json").then(e=>{if(!e.ok)throw new Error("Could not fetch game text.");return e.json()}),b=(e,t)=>e==null?void 0:e.filter(r=>r.difficulty===t),C=e=>e[Math.floor(Math.random()*e.length)],L=e=>M(e.split(" ")),M=e=>e.flatMap(t=>[t," "]),A=e=>new T(e.text.split("")),O=e=>{e.forEach((t,r)=>{var g;const s=(g=a(n.GAMEBOARD))==null?void 0:g.querySelector(".words-wrapper"),i=N();r===0&&i.classList.add("active"),t.split("").forEach((I,x)=>i.appendChild(D(I,x))),s==null||s.appendChild(i)})},N=()=>{const e=document.createElement("div");return e.classList.add("word"),e},D=(e,t)=>{const r=document.createElement("letter");return r.classList.add("letter"),r.id=t.toString(),r.innerText=e,r};function R(e){if(!a(n.GAMEBOARD))throw new Error("Gameboard not found.");return console.log("Initialising gameboard with settings: Difficulty: "+e+"."),y(e).then(({words:t,gameText:r})=>(console.log("Gametext: "+r.text),O(t),m(n.GAMEBOARD),console.log("Gameboard initialised."),A(r)))}const o=class o{constructor(t){this.subject=t,o.setInnerHTML(t.getTimeString()),t.registerObserver(this)}static getClockElement(){return document.getElementById(this.ELEMENT_ID)}static setInnerHTML(t){const r=o.getClockElement();r&&(r.innerHTML=t)}update(t){console.log("ClockDisplay: update"),o.setInnerHTML(t)}};o.ELEMENT_ID="clock";let l=o;const c=class c{constructor(){this.pressedKey="",this.observers=[]}setPressedKey(t,r){r==="Shift"||r==="Ctrl"||(this.pressedKey=r,console.log("Input: set pressed key to "+r),this.notifyObservers())}getPressedKey(){return this.pressedKey}registerObserver(t){this.observers.push(t)}unregisterObserver(t){this.observers=this.observers.filter(r=>r!==t)}notifyObservers(){this.observers.forEach(t=>t.update(this.pressedKey))}registerToDocument(){document.addEventListener("keydown",t=>this.setPressedKey(t,t.key))}unregisterFromDocument(){document.removeEventListener("keydown",t=>this.setPressedKey(t,t.key))}static getSingleton(){return c.singleton}};c.singleton=new c;let u=c;class h{constructor(t){this.gameTextIterator=t??new T([]),u.getSingleton().registerObserver(this)}update(t){console.log(this.checkInput(t,h.getInstance().gameTextIterator.next())),console.log(h.getInstance().getCurrentLetterElement())}checkInput(t,r){return t===r}getCurrentLetterElement(){return this.gameTextIterator.hasNext()?document.querySelectorAll("letter")[this.gameTextIterator.getCurrentIndex()]:null}static getInstance(){return this.singleton||(this.singleton=new this),this.singleton}setGameTextIterator(t){this.gameTextIterator=t}}class d{constructor(t){this.clock=new p(t.gameLength),this.gameState=new S}startRound(){this.clock.start(),u.getSingleton().registerToDocument()}endRound(){}resetRound(){}static getInstance(){return this.instance}static init(t){this.instance=new d(t),new l(this.instance.clock),R(t.difficulty).then(r=>{h.getInstance().setGameTextIterator(r),this.getInstance().startRound()}),console.log("GameRound initialized")}}var E=(e=>(e[e.EASY=1]="EASY",e[e.MEDIUM=2]="MEDIUM",e[e.HARD=3]="HARD",e))(E||{}),f=(e=>(e[e.TEN_SECONDS=10]="TEN_SECONDS",e[e.HALF_MINUTE=30]="HALF_MINUTE",e[e.ONE_MINUTE=60]="ONE_MINUTE",e[e.TWO_MINUTES=120]="TWO_MINUTES",e))(f||{});function k(){if(!a(n.START))throw new Error("Start screen not found.");_(),m(n.START)}const _=()=>{var t;const e=(t=a(n.START))==null?void 0:t.querySelector("form");if(!e)throw new Error("Start form not found.");e.addEventListener("submit",r=>{r.preventDefault();const s=G(r.currentTarget),i={difficulty:E[s.difficulty],gameLength:f[s.gameLength]};d.init(i),v(n.START)})},G=e=>{const t=new FormData(e);return{difficulty:t.get("difficulty"),gameLength:t.get("gameLength")}};k();
